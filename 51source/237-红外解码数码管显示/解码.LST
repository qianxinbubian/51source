C51 COMPILER V7.06   解码                                                                  05/13/2009 11:27:40 PAGE 1   


C51 COMPILER V7.06, COMPILATION OF MODULE 解码
OBJECT MODULE PLACED IN 解码.OBJ
COMPILER INVOKED BY: d:\Keil\C51\BIN\C51.EXE 解码.c BROWSE DEBUG OBJECTEXTEND

stmt level    source

   1          /*-----------------------------------------------
   2            名称：遥控器红外解码液晶显示
   3            公司：上海浩豚电子科技有限公司
   4            编写：师访
   5            日期：2009.5
   6            修改：无
   7            内容：
   8          ------------------------------------------------*/
   9          #include<reg52.h>    //包含头文件，一般情况不需要改动，头文件包含特殊功能寄存器的定义
  10          #include<stdio.h>
  11          #include<intrins.h>
  12          
  13          
  14          #define TURE 1
  15          #define FALSE 0
  16          
  17          
  18          sbit IR=P3^2;  //红外接口标志
  19          
  20          unsigned char const dofly[]={0x3f,0x06,0x5b,0x4f,0x66,0x6d,0x7d,0x07,0x7f,0x6f};
  21          
  22          /******************************************************************/
  23          /*                    变量声明                                    */
  24          /******************************************************************/
  25          
  26          unsigned char  irtime;//红外用全局变量
  27          
  28          bit irpro_ok,irok;
  29          unsigned char IRcord[4];
  30          unsigned char   irdata[33];
  31          
  32          /******************************************************************/
  33          /*                    函数声明                                    */
  34          /******************************************************************/
  35          
  36          void Delay(unsigned char mS);
  37          void Ir_work(void);
  38          void Ircordpro(void);
  39          
  40          /******************************************************************/
  41          /*                    定时器0中断服务函数                         */
  42          /******************************************************************/
  43          
  44          void tim0_isr (void) interrupt 1 using 1//定时器0中断服务函数
  45          {
  46   1        irtime++;                             //用于计数2个下降沿之间的时间
  47   1      }
  48          
  49          /******************************************************************/
  50          /*                    外部中断0函数                               */
  51          /******************************************************************/
  52          void ex0_isr (void) interrupt 0 using 0//外部中断0服务函数
  53          {
  54   1        static unsigned char  i;             //接收红外信号处理
  55   1        static bit startflag;                //是否开始处理标志位
C51 COMPILER V7.06   解码                                                                  05/13/2009 11:27:40 PAGE 2   

  56   1      
  57   1       if(startflag)                         
  58   1       {
  59   2         
  60   2          if(irtime<63&&irtime>=33)//引导码 TC9012的头码，9ms+4.5ms
  61   2                  i=0;
  62   2           
  63   2                      irdata[i]=irtime;//存储每个电平的持续时间，用于以后判断是0还是1
  64   2                      irtime=0;
  65   2                      i++;
  66   2                               if(i==33)
  67   2                              {
  68   3                                       irok=1;
  69   3                                       i=0;
  70   3                                      }
  71   2                }
  72   1               
  73   1               else
  74   1                      {irtime=0;startflag=1;}
  75   1      
  76   1      }
  77          
  78          /******************************************************************/
  79          /*                   定时器0初始化                                */
  80          /******************************************************************/
  81          void TIM0init(void)//定时器0初始化
  82          {
  83   1      
  84   1        TMOD=0x02;//定时器0工作方式2，TH0是重装值，TL0是初值
  85   1        TH0=0x00; //重载值
  86   1        TL0=0x00; //初始化值
  87   1        ET0=1;    //开中断
  88   1        TR0=1;    
  89   1      }
  90          /******************************************************************/
  91          /*                   外部中断初始化                               */
  92          /******************************************************************/
  93          void EX0init(void)
  94          {
  95   1       IT0 = 1;   //指定外部中断0下降沿触发，INT0 (P3.2)
  96   1       EX0 = 1;   //使能外部中断
  97   1       EA = 1;    //开总中断
  98   1      }
  99          /******************************************************************/
 100          /*                    红外键值处理                                */
 101          /******************************************************************/
 102          
 103            void Ir_work(void)//红外键值散转程序
 104            {
 105   1             switch(IRcord[2])//判断第三个数码值
 106   1                       {
 107   2                               case 0:P0=dofly[1];break;//1 显示相应的按键值
 108   2                               case 1:P0=dofly[2];break;//2
 109   2                               case 2:P0=dofly[3];break;//3
 110   2                               case 3:P0=dofly[4];break;//4
 111   2                               case 4:P0=dofly[5];break;//5
 112   2                               case 5:P0=dofly[6];break;//6
 113   2                               case 6:P0=dofly[7];break;//7
 114   2                               case 7:P0=dofly[8];break;//8
 115   2                               case 8:P0=dofly[9];break;//9
 116   2      
 117   2                               }
C51 COMPILER V7.06   解码                                                                  05/13/2009 11:27:40 PAGE 3   

 118   1      
 119   1                        irpro_ok=0;//处理完成标志
 120   1      
 121   1        }
 122          /******************************************************************/
 123          /*                    红外解码函数处理                            */
 124          /******************************************************************/
 125          void Ircordpro(void)//红外码值处理函数
 126          { 
 127   1        unsigned char i, j, k;
 128   1        unsigned char cord,value;
 129   1      
 130   1        k=1;
 131   1        for(i=0;i<4;i++)      //处理4个字节
 132   1           {
 133   2            for(j=1;j<=8;j++) //处理1个字节8位
 134   2               {
 135   3                cord=irdata[k];
 136   3                if(cord>7)//大于某值为1，这个和晶振有绝对关系，这里使用12M计算，此值可以有一定误差
 137   3                          {
 138   4                   value=value|0x80;
 139   4                              }
 140   3                else 
 141   3                          {
 142   4                   value=value;
 143   4                              }
 144   3                if(j<8)
 145   3                          {
 146   4                               value=value>>1;
 147   4                              }
 148   3                 k++;
 149   3               }
 150   2           IRcord[i]=value;
 151   2           value=0;     
 152   2           } irpro_ok=1;//处理完毕标志位置1
 153   1          
 154   1      }
 155          
 156          
 157          
 158          
 159          /////////////////////////////////////////////////////////////////
 160          
 161          void main(void)
 162          {
 163   1       EX0init(); //初始化外部中断
 164   1       TIM0init();//初始化定时器
 165   1      
 166   1       P2=0x00;//1位数码管全部显示
 167   1      
 168   1       while(1)//主循环
 169   1         {
 170   2          if(irok)                        //如果接收好了进行红外处理
 171   2                {   
 172   3                 Ircordpro();
 173   3                 irok=0;
 174   3                }
 175   2      
 176   2          if(irpro_ok)                   //如果处理好后进行工作处理，如按对应的按键后显示对应的数字等
 177   2                {
 178   3                 Ir_work();
 179   3                }
C51 COMPILER V7.06   解码                                                                  05/13/2009 11:27:40 PAGE 4   

 180   2         }
 181   1      }
 182            
 183            


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    247    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     49    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =      3    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
