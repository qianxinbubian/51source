C51 COMPILER V8.02   12864LCDTEST                                                          07/11/2009 14:25:14 PAGE 1   


C51 COMPILER V8.02, COMPILATION OF MODULE 12864LCDTEST
OBJECT MODULE PLACED IN 12864LCDTEST.OBJ
COMPILER INVOKED BY: C:\Keil\C51\BIN\C51.EXE 12864LCDTEST.C BROWSE DEBUG OBJECTEXTEND

line level    source

   1          /******************************************************************************
   2          文件名 ： .c
   3          模块名称：st7920 并行方式驱动12864液晶驱动
   4          功能概要：st7920显示驱动
   5          ******************************************************************************/
   6          #include <reg52.h>
   7          
   8          #define uint  unsigned int
   9          #define uchar unsigned char
  10          #define x1    0x80
  11          #define x2    0x88
  12          #define y     0x80
  13          #define comm  0
  14          #define dat   1
  15          
  16          sbit RS = P2^0;   //H=data; L="command";
  17          sbit RW = P2^1;   //H=read; L="write";
  18          sbit  E = P2^2;   //input enable;
  19          sbit PSB= P2^3;   //H=并口; L="串口";
  20          sbit RST= P2^4;   //Reset Signal 低电平有效
  21          
  22          sbit busy=P0^7;   //lcd busy bit
  23          
  24          void wr_lcd (uchar dat_comm,uchar content);
  25          void chk_busy (void);
  26          void delay (uint us);
  27          
  28          uchar code tab1[]={
  29          "欢迎你使用锐志电"
  30          "能实验板功能超强"
  31          "子的RZ-51PRO多功"
  32          "学习单片机的首选"
  33          };
  34          
  35          uchar code tab31[]={
  36          "天津锐志电子科技"
  37          "WWW.RICHMCU.COM"
  38          };
  39          uchar code tab32[]={
  40          /*--  调入了一幅图像：F:\梁\画图\HOCO12832.bmp  --*/
  41          /*--  宽度x高度=128x32  --*/
  42          0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  43          0x00,0x1E,0x00,0x00,0x00,0x00,0x00,0x07,0xF0,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  44          0x00,0x7F,0x80,0x00,0x00,0x00,0x00,0x18,0x0C,0x00,0x00,0x01,0x00,0x00,0x00,0x00,
  45          0x01,0xFF,0x80,0x00,0x00,0x00,0x00,0x20,0x00,0x00,0x00,0x13,0x10,0x03,0xFE,0x00,
  46          0x03,0xFF,0xC0,0x00,0x00,0x00,0x00,0x58,0x00,0x00,0x00,0x3F,0x30,0x1F,0xFF,0xC0,
  47          0x03,0xFF,0xE0,0x00,0x00,0x00,0x00,0x8C,0x03,0xF0,0x00,0x7F,0xE0,0x7C,0x01,0xE0,
  48          0x03,0xFF,0xF0,0x00,0x00,0x00,0x01,0x36,0x06,0xC0,0x00,0x5F,0xC0,0xFF,0xFC,0x60,
  49          0x01,0xFF,0xF0,0x00,0x00,0x00,0x02,0x1B,0x0F,0x80,0x00,0xFF,0x01,0xFE,0x0F,0x30,
  50          0x00,0xEF,0xF0,0x00,0x00,0x00,0x02,0x6D,0x9F,0x00,0x00,0x3E,0x03,0xFF,0xF1,0x90,
  51          0x00,0xFF,0xF8,0x00,0x00,0x00,0x04,0x36,0xFE,0x00,0x01,0xFF,0x07,0xFF,0xFC,0x90,
  52          0x00,0xEF,0xFF,0xFF,0x80,0x00,0x04,0xDB,0x7E,0x00,0x03,0xFF,0x87,0xFF,0xFC,0xD0,
  53          0x00,0x0F,0xFF,0xFF,0xC0,0x00,0x04,0x6D,0xFC,0x00,0x07,0xFF,0x8F,0xFF,0xFE,0x50,
  54          0x00,0x0F,0xFF,0xFF,0xE0,0x00,0x04,0x36,0xFC,0x10,0x07,0xFF,0x8F,0xFF,0xFE,0x90,
  55          0x00,0x0F,0xFF,0xFF,0xE0,0x00,0x04,0x1B,0xF8,0x10,0x07,0xFF,0xCF,0xFF,0xFE,0x80,
C51 COMPILER V8.02   12864LCDTEST                                                          07/11/2009 14:25:14 PAGE 2   

  56          0x00,0x0F,0xFF,0xFF,0xF0,0x00,0x04,0x0F,0xF8,0x10,0x07,0xFF,0xFF,0xFF,0xFA,0x00,
  57          0x00,0x07,0xFF,0xFF,0xF0,0x00,0x04,0x07,0xF0,0x10,0x07,0xFF,0xFF,0xFF,0xFA,0x00,
  58          0x00,0xFF,0xFF,0xFF,0xF8,0x00,0x02,0x03,0xF0,0x20,0x07,0xFF,0xFF,0xFF,0xBA,0x00,
  59          0x00,0xFD,0xFF,0xFF,0xFC,0x00,0x02,0x03,0xF0,0x20,0x03,0xFF,0xFF,0xDF,0xB8,0x00,
  60          0x00,0xC1,0xC0,0x3F,0xFC,0x00,0x01,0x01,0xE0,0x40,0x00,0xFF,0xFF,0xDF,0xB0,0x00,
  61          0x00,0x81,0xC0,0x3F,0xCE,0x00,0x00,0x81,0xE0,0x80,0x00,0x7F,0xFF,0xDF,0xA0,0x00,
  62          0x00,0x81,0x80,0x1D,0xCF,0x00,0x00,0x41,0xE1,0x00,0x00,0x3F,0xFF,0x9B,0x00,0x00,
  63          0x01,0x83,0x80,0x1F,0xC7,0x80,0x00,0x21,0xE2,0x00,0x00,0x1F,0xFD,0xB6,0x00,0x00,
  64          0x01,0xC3,0x00,0x0E,0xE6,0x80,0x00,0x19,0xEC,0x00,0x00,0x07,0xFE,0x20,0x00,0x00,
  65          0x00,0xC3,0x00,0x07,0x67,0x40,0x00,0x07,0xF0,0x00,0x00,0x03,0x3E,0x00,0x00,0x00,
  66          0x00,0x02,0x00,0x03,0xE7,0xA0,0x00,0x00,0x00,0x00,0x00,0x02,0x8E,0x00,0x00,0x00,
  67          0x00,0x06,0x00,0x03,0x83,0x00,0x00,0x00,0x00,0x00,0x00,0x02,0x03,0x00,0x00,0x00,
  68          0x00,0x06,0x00,0x07,0x03,0x00,0x77,0x46,0x74,0x24,0x80,0x06,0x04,0x00,0x00,0x00,
  69          0x00,0x1C,0x00,0x06,0x00,0x00,0x55,0x45,0x54,0x57,0x80,0x00,0x00,0x00,0x00,0x00,
  70          0x00,0x1C,0x00,0x0E,0x00,0x00,0x45,0x45,0x74,0x57,0x80,0x08,0x00,0x00,0x00,0x00,
  71          0x00,0x00,0x00,0x1C,0x00,0x00,0x55,0x45,0x44,0x74,0x80,0xF0,0x00,0x00,0x00,0x00,
  72          0x00,0x00,0x00,0x38,0x00,0x00,0x77,0x76,0x47,0x54,0x80,0x00,0x00,0x00,0x00,0x00,
  73          0x00,0x00,0x00,0x00,0x00,0x00,0x10,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00
  74          };
  75          
  76          uchar code tab5[]={
  77          /*--  调入了一幅图像：F:\梁\画图\COCK.bmp  --*/
  78          /*--  宽度x高度=128x64  --*/
  79          0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  80                0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  81                0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  82                0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  83                0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  84                0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  85                0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  86                0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  87                0x00,0x00,0x00,0x04,0x00,0xC0,0x00,0x38,
  88                0x00,0x00,0x30,0x00,0x00,0x69,0xC0,0x00,
  89                0x00,0x00,0x00,0x04,0x18,0xC0,0x00,0x18,
  90                0x00,0x00,0x30,0x00,0x01,0xFF,0xF0,0x00,
  91                0x00,0x00,0x00,0x0C,0x18,0xC0,0x0A,0xBD,
  92                0x50,0x1D,0x75,0xE0,0x01,0xC0,0xF0,0x00,
  93                0x00,0x74,0x00,0x3F,0x8C,0x80,0x1F,0xFF,
  94                0xF0,0x3F,0xFF,0xF0,0x00,0x0D,0xE0,0x00,
  95                0x03,0x8F,0x00,0xF0,0x3F,0xF0,0x30,0x18,
  96                0x00,0x18,0x30,0x60,0x00,0x07,0x00,0x00,
  97                0x0C,0x03,0x80,0xDF,0x30,0x70,0x00,0x38,
  98                0x00,0x1D,0x75,0x60,0x05,0x57,0x54,0x00,
  99                0x10,0x41,0x80,0x3E,0x30,0x20,0x07,0xFF,
 100                0xE0,0x1F,0xFF,0xE0,0x1F,0xFF,0xFF,0x80,
 101                0x21,0xC1,0xC0,0x04,0x3C,0xF0,0x02,0x08,
 102                0x00,0x18,0x30,0x60,0x3F,0x47,0xBF,0x80,
 103                0x40,0xC1,0x80,0x7F,0x9F,0xA0,0x02,0x19,
 104                0x80,0x1D,0x7F,0xE0,0x30,0x03,0x03,0x00,
 105                0xC1,0xC1,0x80,0x2E,0x05,0x80,0x27,0x99,
 106                0x80,0x0F,0xFF,0xE0,0x00,0x03,0x00,0x00,
 107                0x81,0x83,0x00,0x04,0x0D,0x00,0x33,0xE3,
 108                0x00,0x0C,0x70,0x00,0x00,0x03,0x00,0x00,
 109                0x81,0x86,0x00,0x0D,0x99,0x80,0x60,0x3E,
 110                0x00,0x00,0x38,0x01,0x00,0x07,0x00,0x00,
 111                0x81,0xBC,0x00,0x0F,0x39,0xC6,0xE0,0x0F,
 112                0xB6,0x00,0x3F,0xBF,0x00,0x07,0x00,0x00,
 113                0x83,0xF0,0x00,0x1E,0xE0,0xFE,0xE0,0x03,
 114                0xFE,0x00,0x0F,0xFE,0x01,0xFF,0x00,0x00,
 115                0xC3,0x30,0x00,0x89,0x80,0x7C,0x00,0x01,
 116                0xF8,0x00,0x07,0xFC,0x00,0x7C,0x00,0x00,
 117                0x63,0x31,0xFF,0x00,0x00,0x00,0x00,0x00,
C51 COMPILER V8.02   12864LCDTEST                                                          07/11/2009 14:25:14 PAGE 3   

 118                0x20,0x00,0x00,0x50,0x00,0x00,0x00,0x00,
 119                0x63,0x19,0x12,0x00,0x00,0x00,0x00,0x00,
 120                0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
 121                0x07,0x19,0x04,0x3F,0xFF,0xFF,0xFF,0xFF,
 122                0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0x80,
 123                0x07,0x19,0x88,0x3F,0xFF,0xFF,0xFF,0xFF,
 124                0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0x80,
 125                0x06,0x0C,0x10,0x00,0x00,0x00,0x00,0x00,
 126                0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
 127                0x0E,0x0C,0x20,0x00,0x00,0x00,0x00,0x00,
 128                0x08,0x00,0x00,0x00,0x00,0x40,0x00,0x00,
 129                0x3E,0x0E,0x40,0x0A,0x6D,0xB4,0x07,0x84,
 130                0x35,0x1A,0x67,0xA2,0x01,0xA7,0x9B,0x00,
 131                0x45,0x86,0x80,0x0A,0xAA,0xB4,0x04,0x44,
 132                0x26,0x92,0x68,0xA2,0x01,0x34,0x93,0x00,
 133                0x00,0x03,0x01,0x0E,0xAE,0xB4,0x04,0x44,
 134                0x61,0x1B,0x68,0xA2,0x01,0x0C,0x5B,0x00,
 135                0x00,0x07,0x03,0x0A,0xBA,0xD8,0x06,0x84,
 136                0x41,0xF2,0xC8,0x22,0x03,0x08,0xD7,0x00,
 137                0x00,0x07,0x87,0x0D,0x96,0x68,0x05,0x84,
 138                0x61,0x9B,0xE8,0x22,0x02,0x0C,0x5F,0x00,
 139                0x00,0x1F,0xF6,0x0D,0xB6,0x58,0x04,0x84,
 140                0x45,0x15,0xA8,0xA2,0x03,0x14,0xD5,0x00,
 141                0x00,0x10,0xFC,0x05,0x92,0x48,0x04,0x84,
 142                0x25,0x93,0xAC,0xA2,0x01,0x24,0x95,0x00,
 143                0x00,0x00,0x00,0x0D,0x96,0x49,0x04,0x44,
 144                0x3D,0x14,0xA7,0x1C,0x41,0xE7,0x15,0x00,
 145                0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
 146                0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
 147                0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
 148                0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
 149                0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
 150                0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
 151                0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
 152                0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
 153                0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
 154                0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
 155                0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
 156                0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
 157                0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
 158                0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
 159                0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
 160                0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
 161                0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
 162                0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
 163                0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
 164                0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
 165                0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
 166                0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
 167                0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
 168                0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
 169                0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
 170                0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
 171                0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
 172                0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
 173                0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
 174                0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
 175                0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
 176                0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
 177                0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
 178                0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
 179                0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
C51 COMPILER V8.02   12864LCDTEST                                                          07/11/2009 14:25:14 PAGE 4   

 180                0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
 181                0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
 182                0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
 183                0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
 184                0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
 185                0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
 186                0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
 187                0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
 188                0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
 189                0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
 190                0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
 191                0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
 192                0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
 193                0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
 194                0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
 195                0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
 196                0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
 197                0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
 198                0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
 199                0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
 200                0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
 201                0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
 202                0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
 203                0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
 204                0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
 205                0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
 206                0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00
 207          };
 208          
 209          /******************************************************************************************
 210          * 函数名称    ：
 211          * 功能描述    ： 
 212          * 参数        ：  参数名称： 输入/输出？ 类型  描述
 213          * 
 214          * 返回值      ：
 215          * 作者        ：
 216          * 创建日期    ：2006-12-19
 217          * 全局变量    ：
 218          * 全局静态变量：
 219          * 局部静态变量：
 220          *----------------------------------------修改历史------------------------------------------
 221          * 当前版本    ：     修改人：                  修改日期：
 222          * 修改说明    ：
 223          ******************************************************************************************/
 224          void init_lcd (void)
 225          {
 226   1         RST = 1;
 227   1         PSB = 1;
 228   1         wr_lcd(comm,0x30);  /*30---基本指令动作*/   
 229   1         wr_lcd(comm,0x01);  /*清屏，地址指针指向00H*/
 230   1         wr_lcd(comm,0x06);  /*光标的移动方向*/
 231   1         wr_lcd(comm,0x0c);  /*开显示，关游标*/
 232   1      }
 233          
 234          /******************************************************************************************
 235          * 函数名称    ：chn_disp
 236          * 功能描述    ： 显示汉字或字符
 237          * 参数        ：  参数名称： 输入/输出？ 类型  描述
 238          * 
 239          * 返回值      ：
 240          * 作者        ：
 241          * 创建日期    ：2006-12-19
C51 COMPILER V8.02   12864LCDTEST                                                          07/11/2009 14:25:14 PAGE 5   

 242          * 全局变量    ：
 243          * 全局静态变量：
 244          * 局部静态变量：
 245          *----------------------------------------修改历史------------------------------------------
 246          * 当前版本    ：     修改人：                  修改日期：
 247          * 修改说明    ：
 248          ******************************************************************************************/
 249          void chn_disp(uchar code *chn)
 250          {
 251   1         uchar i,j;
 252   1         wr_lcd(comm,0x30);
 253   1         wr_lcd(comm,0x80);
 254   1         for(j=0;j<4;j++)
 255   1         {
 256   2           for(i=0;i<16;i++)
 257   2           wr_lcd(dat,chn[j*16+i]);
 258   2         }
 259   1      }
 260          
 261          /******************************************************************************************
 262          * 函数名称    ：chn_disp1
 263          * 功能描述    ： 上半屏显示汉字或字符
 264          * 参数        ：  参数名称： 输入/输出？ 类型  描述
 265          * 
 266          * 返回值      ：
 267          * 作者        ：
 268          * 创建日期    ：2006-12-19
 269          * 全局变量    ：
 270          * 全局静态变量：
 271          * 局部静态变量：
 272          *----------------------------------------修改历史------------------------------------------
 273          * 当前版本    ：     修改人：                  修改日期：
 274          * 修改说明    ：
 275          ******************************************************************************************/
 276          void chn_disp1(uchar code *chn)
 277          {
 278   1         uchar i,j;
 279   1         wr_lcd(comm,0x30);
 280   1         wr_lcd(comm,0x80);
 281   1         j=0;
 282   1         for(i=0;i<16;i++)
 283   1         wr_lcd(dat,chn[j*16+i]);
 284   1         wr_lcd(comm,0x90);
 285   1         j=1;
 286   1         for(i=0;i<16;i++)
 287   1         wr_lcd(dat,chn[j*16+i]);
 288   1      }
 289          
 290          /******************************************************************************************
 291          * 函数名称    ：img_disp
 292          * 功能描述    ： 显示图形
 293          * 参数        ：  参数名称： 输入/输出？ 类型  描述
 294          * 
 295          * 返回值      ：
 296          * 作者        ：
 297          * 创建日期    ：2006-12-19
 298          * 全局变量    ：
 299          * 全局静态变量：
 300          * 局部静态变量：
 301          *----------------------------------------修改历史------------------------------------------
 302          * 当前版本    ：     修改人：                  修改日期：
 303          * 修改说明    ：
C51 COMPILER V8.02   12864LCDTEST                                                          07/11/2009 14:25:14 PAGE 6   

 304          ******************************************************************************************/
 305          void img_disp(uchar code *img)
 306          {
 307   1         uchar i,j;
 308   1         for(j=0;j<32;j++)
 309   1         {
 310   2           for(i=0;i<8;i++)
 311   2           {
 312   3             wr_lcd(comm,0x34);
 313   3             wr_lcd(comm,y+j);
 314   3             wr_lcd(comm,x1+i);
 315   3             wr_lcd(comm,0x30);
 316   3             wr_lcd(dat,img[j*16+i*2]);
 317   3             wr_lcd(dat,img[j*16+i*2+1]);
 318   3           }
 319   2         }
 320   1         for(j=32;j<64;j++)
 321   1         {
 322   2           for(i=0;i<8;i++)
 323   2           {
 324   3             wr_lcd(comm,0x34);
 325   3             wr_lcd(comm,y+j-32);
 326   3             wr_lcd(comm,x2+i);
 327   3             wr_lcd(comm,0x30);
 328   3             wr_lcd(dat,img[j*16+i*2]);
 329   3             wr_lcd(dat,img[j*16+i*2+1]);
 330   3           }
 331   2         }
 332   1         wr_lcd (comm,0x36);
 333   1      }
 334          
 335          /******************************************************************************************
 336          * 函数名称    ：img_disp1
 337          * 功能描述    ： 下半屏显示图形
 338          * 参数        ：  参数名称： 输入/输出？ 类型  描述
 339          * 
 340          * 返回值      ：
 341          * 作者        ：
 342          * 创建日期    ：2006-12-19
 343          * 全局变量    ：
 344          * 全局静态变量：
 345          * 局部静态变量：
 346          *----------------------------------------修改历史------------------------------------------
 347          * 当前版本    ：     修改人：                  修改日期：
 348          * 修改说明    ：
 349          ******************************************************************************************/
 350          void img_disp1(uchar code *img)
 351          {
 352   1         uchar i,j;
 353   1         for(j=0;j<32;j++)
 354   1         {
 355   2           for(i=0;i<8;i++)
 356   2           {
 357   3             wr_lcd(comm,0x34);
 358   3             wr_lcd(comm,y+j);
 359   3             wr_lcd(comm,x2+i);
 360   3             wr_lcd(comm,0x30);
 361   3             wr_lcd(dat,img[j*16+i*2]);
 362   3             wr_lcd(dat,img[j*16+i*2+1]);
 363   3           }
 364   2         }
 365   1         wr_lcd(comm,0x36);
C51 COMPILER V8.02   12864LCDTEST                                                          07/11/2009 14:25:14 PAGE 7   

 366   1      }
 367          
 368          /******************************************************************************************
 369          * 函数名称    ：lat_disp
 370          * 功能描述    ： 显示点阵
 371          * 参数        ：  参数名称： 输入/输出？ 类型  描述
 372          * 
 373          * 返回值      ：
 374          * 作者        ：
 375          * 创建日期    ：2006-12-19
 376          * 全局变量    ：
 377          * 全局静态变量：
 378          * 局部静态变量：
 379          *----------------------------------------修改历史------------------------------------------
 380          * 当前版本    ：     修改人：                  修改日期：
 381          * 修改说明    ：
 382          ******************************************************************************************/
 383          /*--------------显示点阵----------------*/
 384          //经过调试发现显示点阵是非常有意思的，最主要的在于data1,data2上的两组数据的取值，
 385          //不同的取值对应着不同的点阵效果。
 386          
 387          void lat_disp(uchar data1,uchar data2)
 388          {
 389   1         uchar i,j,k,x;
 390   1         x=x1;
 391   1         for(k=0;k<2;k++)
 392   1         {
 393   2           for(j=0;j<16;j++)
 394   2           {
 395   3             for(i=0;i<8;i++)
 396   3             {
 397   4               wr_lcd(comm,0x34);
 398   4                wr_lcd(comm,y+j*2);
 399   4               wr_lcd(comm,x+i);
 400   4               wr_lcd(comm,0x30);
 401   4               wr_lcd(dat,data1);
 402   4               wr_lcd(dat,data1);
 403   4             }
 404   3             for(i=0;i<8;i++)
 405   3             {
 406   4               wr_lcd(comm,0x34);
 407   4               wr_lcd(comm,y+j*2+1);
 408   4               wr_lcd(comm,x+i);
 409   4               wr_lcd(comm,0x30);
 410   4               wr_lcd(dat,data2);
 411   4               wr_lcd(dat,data2);
 412   4             }
 413   3           }
 414   2           x=x2;
 415   2         }
 416   1         wr_lcd(comm,0x36);
 417   1      }
 418          
 419          /******************************************************************************************
 420          * 函数名称    ：con_disp
 421          * 功能描述    ： 当data1=0xff,data2=0xff时,在x0,y0处反白显示16xl*yl
 422          * 参数        ：  参数名称： 输入/输出？ 类型  描述
 423          * 
 424          * 返回值      ：
 425          * 作者        ：
 426          * 创建日期    ：2006-12-19
 427          * 全局变量    ：
C51 COMPILER V8.02   12864LCDTEST                                                          07/11/2009 14:25:14 PAGE 8   

 428          * 全局静态变量：
 429          * 局部静态变量：
 430          *----------------------------------------修改历史------------------------------------------
 431          * 当前版本    ：     修改人：                  修改日期：
 432          * 修改说明    ：
 433          ******************************************************************************************/
 434          void con_disp(uchar data1,uchar data2,uchar x0,uchar y0,uchar xl,uchar yl)
 435          {
 436   1         uchar i,j;
 437   1         for(j=0;j<yl;j++)
 438   1         {
 439   2           for(i=0;i<xl;i++)
 440   2           {
 441   3             wr_lcd(comm,0x34);
 442   3             wr_lcd(comm,y0+j);
 443   3             wr_lcd(comm,x0+i);
 444   3             wr_lcd(comm,0x30);
 445   3             wr_lcd(dat,data1);
 446   3             wr_lcd(dat,data2);
 447   3           }
 448   2         }
 449   1         wr_lcd(comm,0x36);
 450   1      }
 451          
 452          /******************************************************************************************
 453          * 函数名称    ：clrram
 454          * 功能描述    ： 清DDRAM
 455          * 参数        ：  参数名称： 输入/输出？ 类型  描述
 456          * 
 457          * 返回值      ：
 458          * 作者        ：
 459          * 创建日期    ：2006-12-19
 460          * 全局变量    ：
 461          * 全局静态变量：
 462          * 局部静态变量：
 463          *----------------------------------------修改历史------------------------------------------
 464          * 当前版本    ：     修改人：                  修改日期：
 465          * 修改说明    ：
 466          ******************************************************************************************/
 467          void clrram(void)
 468          {
 469   1         wr_lcd(comm,0x30);
 470   1         wr_lcd(comm,0x01);
 471   1      }
 472          
 473          /******************************************************************************************
 474          * 函数名称    ：wr_lcd
 475          * 功能描述    ： 
 476          * 参数        ：  参数名称： 输入/输出？ 类型  描述
 477          * 
 478          * 返回值      ：
 479          * 作者        ：
 480          * 创建日期    ：2006-12-19
 481          * 全局变量    ：
 482          * 全局静态变量：
 483          * 局部静态变量：
 484          *----------------------------------------修改历史------------------------------------------
 485          * 当前版本    ：     修改人：                  修改日期：
 486          * 修改说明    ：
 487          ******************************************************************************************/
 488          void wr_lcd(uchar dat_comm,uchar content)
 489          {
C51 COMPILER V8.02   12864LCDTEST                                                          07/11/2009 14:25:14 PAGE 9   

 490   1         chk_busy ();
 491   1         if(dat_comm)
 492   1          {
 493   2           RS = 1;   //data
 494   2           RW = 0;   //write
 495   2          }
 496   1         else 
 497   1          {
 498   2           RS = 0;   //command
 499   2           RW = 0;   //write
 500   2          }
 501   1         P0=content;   //output data or comm
 502   1         E = 1;
 503   1         ;
 504   1         E = 0;
 505   1      }
 506          /******************************************************************************************
 507          * 函数名称    ：chk_busy
 508          ******************************************************************************************/
 509          void chk_busy(void)
 510          {
 511   1         P0 = 0xff;
 512   1         RS = 0;
 513   1         RW = 1;
 514   1         E = 1;
 515   1         while(busy==1);
 516   1         E = 0;
 517   1      }
 518          
 519          void delay(uint us)   //delay time
 520          {
 521   1         while(us--);
 522   1      }
 523          
 524          void delay1(uint ms)
 525          {
 526   1         uint i,j;
 527   1         for(i=0;i<ms;i++)
 528   1         for(j=0;j<15;j++)
 529   1         delay(1);
 530   1      }
 531          
 532          
 533          void main()
 534          {
 535   1         init_lcd();
 536   1         while(1)
 537   1         {
 538   2           lat_disp(0x00,0x00);
 539   2           chn_disp(tab1);
 540   2           con_disp(0xff,0xff,0x8c,0x80,2,16);
 541   2           delay1(8000);
 542   2           clrram();
 543   2           lat_disp(0xcc,0xcc);
 544   2           delay1(8000);
 545   2           lat_disp(0x00,0x00);
 546   2           chn_disp1(tab31);
 547   2           img_disp1(tab32);
 548   2           delay1 (8000);
 549   2           clrram();
 550   2           lat_disp (0xff,0x00);
 551   2           delay1(8000);
C51 COMPILER V8.02   12864LCDTEST                                                          07/11/2009 14:25:14 PAGE 10  

 552   2           img_disp(tab5);
 553   2           delay1(8000);
 554   2         }
 555   1      }
 556          
 557          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =   1037    ----
   CONSTANT SIZE    =   1633    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----      34
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
