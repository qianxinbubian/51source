C51 COMPILER V7.02b   __口接收试验                                                         02/25/2010 09:20:42 PAGE 1   


C51 COMPILER V7.02b, COMPILATION OF MODULE __口接收试验
OBJECT MODULE PLACED IN 串口接收试验.OBJ
COMPILER INVOKED BY: D:\Progrom\Keil\C51\BIN\C51.EXE 串口接收试验.c BROWSE DEBUG OBJECTEXTEND

stmt level    source

   1          /********************************************************************
   2          * 文件名  ： 串口接收试验.c
   3          * 描述    :  该文件实现通过单片机从电脑接收数据。通过数码管显示
   4                                   该试验使用的晶振是11.0592,如果使用12M晶振，会出现串口接收
   5                                   不正常的情况。原因是用12M晶振，波特率9600时的误差率达 8%
   6                                   当下载这个程序到单片机时，单片机的最高为为乱码，是正常现象，
   7                                   按一下复位键便可。是由于单片机下载也是通过串口下载引起的。
   8          * 创建人  ： 东流，2009年4月8日
   9          * 版本号  ： 2.0
  10          * 感谢“中国自动化资讯网”对本工作室的大力支持。
  11          ***********************************************************************/
  12          #include<reg52.h>
  13          #include<intrins.h>
  14          
  15          #define uchar unsigned char
  16          #define uint  unsigned int 
  17          
  18          uchar code table[10] = {0x3f,0x06,0x5b,0x4f,0x66,0x6d,0x7d,0x07,0x7f,0x6f};
  19          uchar LED_Buffer[8] = {0};      //从串口接收的数据
  20          
  21          /********************************************************************
  22          * 名称 : Delay_1ms()
  23          * 功能 : 延时子程序，延时时间为 1ms * x
  24          * 输入 : x (延时一毫秒的个数)
  25          * 输出 : 无
  26          ***********************************************************************/
  27          void Delay_1ms(uint i)//1ms延时
  28          {
  29   1              uchar x,j;
  30   1              for(j=0;j<i;j++)
  31   1              for(x=0;x<=148;x++);    
  32   1      }
  33          
  34          /********************************************************************
  35          * 名称 : Com_Int()
  36          * 功能 : 串口中断子函数
  37          * 输入 : 无
  38          * 输出 : 无
  39          ***********************************************************************/
  40          void Com_Int(void) interrupt 4
  41          {
  42   1              static uchar i = 7;    //定义为静态变量，当重新进入这个子函数时 i 的值不会发生改变
  43   1              EA = 0;
  44   1              if(RI == 1)   //当硬件接收到一个数据时，RI会置位
  45   1              {
  46   2                      LED_Buffer[i] = SBUF - 48; //这里减去48是因为从电脑中发送过来的数据是ASCII码。
  47   2                      RI = 0;  
  48   2                      if(i==0) i = 8;  
  49   2                      i--;            
  50   2              }
  51   1              EA = 1;
  52   1      }
  53          
  54          /********************************************************************
  55          * 名称 : Com_Init()
C51 COMPILER V7.02b   __口接收试验                                                         02/25/2010 09:20:42 PAGE 2   

  56          * 功能 : 串口初始化，晶振11.0592,波特率9600，使能了串口中断
  57          * 输入 : 无
  58          * 输出 : 无
  59          ***********************************************************************/
  60          void Com_Init(void)
  61          {
  62   1           TMOD = 0x20;
  63   1           PCON = 0x00;
  64   1           SCON = 0x50;                       
  65   1           TH1 = 0xFd;    //设置波特率 9600
  66   1           TL1 = 0xFd;
  67   1           TR1 = 1;           //启动定时器1
  68   1               ES = 1;                //开串口中断
  69   1               EA = 1;                //开总中断              
  70   1      }
  71          
  72          /********************************************************************
  73          * 名称 : Main()
  74          * 功能 : 主函数
  75          * 输入 : 无
  76          * 输出 : 无
  77          ***********************************************************************/
  78          void Main()
  79          {
  80   1              uchar i = 0;
  81   1              Delay_1ms(100);
  82   1              Com_Init();
  83   1              P2 = 0x80;  //这里把P2口的最高为置1，进入循环后 循环左移 一位正好是P2 最低为置1
  84   1              while(1)
  85   1              {
  86   2                      P0 = table[LED_Buffer[i]];
  87   2                      P2 = i++;
  88   2                      Delay_1ms(1);
  89   2                      if(i == 8) i=0;
  90   2              }
  91   1      }                                                  


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    138    ----
   CONSTANT SIZE    =     10    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      9    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
