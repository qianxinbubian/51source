C51 COMPILER V7.50   IRLCD                                                                 11/08/2010 20:39:54 PAGE 1   


C51 COMPILER V7.50, COMPILATION OF MODULE IRLCD
OBJECT MODULE PLACED IN IRLCD.OBJ
COMPILER INVOKED BY: E:\Program Files\KEIL\C51\BIN\C51.EXE IRLCD.C BROWSE DEBUG OBJECTEXTEND

line level    source

   1          
   2          /********************************************************************************
   3          *  描述:                                                                       *
   4          *                                                                   *
   5          ********************************************************************************/
   6          
   7          #include <reg51.h>
   8          #include <intrins.h>
   9          
  10          #define uchar unsigned char
  11          #define uint  unsigned int
  12          
  13          uchar LCD_ID_1[16] = {"Red Control"};
  14          uchar LCD_ID_2[16] = {"IR CODE:--H"};
  15          
  16          void delay(uchar x);  //x*0.14MS
  17          void delay1(int ms);
  18          void beep();
  19          
  20          sbit IRIN = P3^3;         //红外接收器数据线
  21          sbit BEEP = P1^5;         //蜂鸣器驱动线
  22          sbit RELAY= P1^4;         //继电器驱动线
  23          
  24          uchar IRCOM[7];
  25          
  26          sbit E=P2^7;            //1602使能引脚
  27          sbit RW=P2^6;           //1602读写引脚  
  28          sbit RS=P2^5;           //1602数据/命令选择引脚
  29          
  30          
  31          /********************************************************************
  32          * 名称 : delay()
  33          * 功能 : 延时,延时时间大概为140US。
  34          * 输入 : 无
  35          * 输出 : 无
  36          ***********************************************************************/
  37          
  38          void Delay2()
  39          {
  40   1              int i,j;
  41   1              for(i=0; i<=10; i++)
  42   1              for(j=0; j<=2; j++)
  43   1      ;
  44   1      }
  45          
  46          
  47          /********************************************************************
  48          * 名称 : enable(uchar del)
  49          * 功能 : 1602命令函数
  50          * 输入 : 输入的命令值
  51          * 输出 : 无
  52          ***********************************************************************/
  53          
  54          void enable(uchar del)
  55          {
C51 COMPILER V7.50   IRLCD                                                                 11/08/2010 20:39:54 PAGE 2   

  56   1              P0 = del;
  57   1              RS = 0;
  58   1              RW = 0;
  59   1              E = 0;
  60   1              Delay2();
  61   1              E = 1;
  62   1              Delay2();
  63   1      }
  64          
  65          /********************************************************************
  66          * 名称 : write(uchar del)
  67          * 功能 : 1602写数据函数
  68          * 输入 : 需要写入1602的数据
  69          * 输出 : 无
  70          ***********************************************************************/
  71          
  72          void write(uchar del)
  73          {
  74   1              P0 = del;
  75   1              RS = 1;
  76   1              RW = 0;
  77   1              E = 0;
  78   1              Delay2();
  79   1              E = 1;
  80   1              Delay2();
  81   1      }
  82          
  83          /********************************************************************
  84          * 名称 : L1602_init()
  85          * 功能 : 1602初始化，请参考1602的资料
  86          * 输入 : 无
  87          * 输出 : 无
  88          ***********************************************************************/
  89          void L1602_init(void)
  90          {
  91   1              enable(0x01);
  92   1              enable(0x38);
  93   1              enable(0x0c);
  94   1              enable(0x06);
  95   1              enable(0xd0);
  96   1      }
  97          
  98          /********************************************************************
  99          * 名称 : L1602_char(uchar hang,uchar lie,char sign)
 100          * 功能 : 改变液晶中某位的值，如果要让第一行，第五个字符显示"b" ，调用该函数如下
 101                           L1602_char(1,5,'b')
 102          * 输入 : 行，列，需要输入1602的数据
 103          * 输出 : 无
 104          ***********************************************************************/
 105          void L1602_char(uchar hang,uchar lie,char sign)
 106          {
 107   1              uchar a;
 108   1              if(hang == 1) a = 0x80;
 109   1              if(hang == 2) a = 0xc0;
 110   1              a = a + lie - 1;
 111   1              enable(a);
 112   1              write(sign);
 113   1      }
 114          
 115          /********************************************************************
 116          * 名称 : L1602_string(uchar hang,uchar lie,uchar *p)
 117          * 功能 : 改变液晶中某位的值，如果要让第一行，第五个字符开始显示"ab cd ef" ，调用该函数如下
C51 COMPILER V7.50   IRLCD                                                                 11/08/2010 20:39:54 PAGE 3   

 118                           L1602_string(1,5,"ab cd ef;")
 119          * 输入 : 行，列，需要输入1602的数据
 120          * 输出 : 无
 121          ***********************************************************************/
 122          void L1602_string(uchar hang,uchar lie,uchar *p)
 123          {
 124   1              uchar a;
 125   1              if(hang == 1) a = 0x80;
 126   1              if(hang == 2) a = 0xc0;
 127   1              a = a + lie - 1;
 128   1              enable(a);
 129   1              while(1)
 130   1              {
 131   2                      if(*p == '\0') break;
 132   2                      write(*p);
 133   2                      p++;
 134   2              }
 135   1      }
 136          
 137          /*******************************************************************/
 138          main()
 139          {
 140   1       
 141   1          IE = 0x84;                 //允许总中断中断,使能 INT1 外部中断
 142   1          TCON = 0x10;               //触发方式为脉冲负边沿触发
 143   1          
 144   1          IRIN=1;                    //I/O口初始化
 145   1          BEEP=1;
 146   1          RELAY=1; 
 147   1              
 148   1          delay1(10);                 //延时
 149   1          L1602_init();               //初始化LCD             
 150   1              L1602_string(1, 1, LCD_ID_1);
 151   1              L1602_string(2, 1, LCD_ID_2);
 152   1         while(1)     ;
 153   1      
 154   1      } //end main
 155          /**********************************************************/
 156          void IR_IN() interrupt 2 using 0
 157          {
 158   1        unsigned char j,k,N=0;
 159   1           EX1 = 0;   
 160   1               delay(15);
 161   1               if (IRIN==1) 
 162   1           { EX1 =1;
 163   2                 return;
 164   2                } 
 165   1                                 //确认IR信号出现
 166   1        while (!IRIN)            //等IR变为高电平，跳过9ms的前导低电平信号。
 167   1          {delay(1);}
 168   1      
 169   1       for (j=0;j<4;j++)         //收集四组数据
 170   1       { 
 171   2        for (k=0;k<8;k++)        //每组数据有8位
 172   2        {
 173   3         while (IRIN)            //等 IR 变为低电平，跳过4.5ms的前导高电平信号。
 174   3           {delay(1);}
 175   3          while (!IRIN)          //等 IR 变为高电平
 176   3           {delay(1);}
 177   3           while (IRIN)           //计算IR高电平时长
 178   3            {
 179   4          delay(1);
C51 COMPILER V7.50   IRLCD                                                                 11/08/2010 20:39:54 PAGE 4   

 180   4          N++;           
 181   4          if (N>=30)
 182   4               { EX1=1;
 183   5               return;}                  //0.14ms计数过长自动离开。
 184   4            }                        //高电平计数完毕                
 185   3           IRCOM[j]=IRCOM[j] >> 1;                  //数据最高位补“0”
 186   3           if (N>=8) {IRCOM[j] = IRCOM[j] | 0x80;}  //数据最高位补“1”
 187   3           N=0;
 188   3        }//end for k
 189   2       }//end for j
 190   1         
 191   1         if (IRCOM[2]!=~IRCOM[3])
 192   1         { EX1=1;
 193   2           return; }
 194   1      
 195   1         IRCOM[5]=IRCOM[2] & 0x0F;     //取键码的低四位
 196   1         IRCOM[6]=IRCOM[2] >> 4;       //右移4次，高四位变为低四位
 197   1      
 198   1         if(IRCOM[5]>9)
 199   1          { IRCOM[5]=IRCOM[5]+0x37;}
 200   1         else
 201   1                IRCOM[5]=IRCOM[5]+0x30;
 202   1      
 203   1         if(IRCOM[6]>9)
 204   1          { IRCOM[6]=IRCOM[6]+0x37;}
 205   1         else
 206   1                IRCOM[6]=IRCOM[6]+0x30;
 207   1      //////////////////////////
 208   1      L1602_char(2,10,IRCOM[5]);
 209   1      L1602_char(2,9,IRCOM[6]);
 210   1           //beep();
 211   1           EX1 = 1; 
 212   1      } 
 213          
 214          /**********************************************************/
 215          void beep()
 216          {
 217   1        unsigned char i;
 218   1        for (i=0;i<100;i++)
 219   1         {
 220   2         delay(4);
 221   2         BEEP=!BEEP;                 //BEEP取反
 222   2         } 
 223   1        BEEP=1;                      //关闭蜂鸣器
 224   1      }
 225          /**********************************************************/
 226          void delay(unsigned char x)    //x*0.14MS
 227          {
 228   1       unsigned char i;
 229   1        while(x--)
 230   1       {
 231   2        for (i = 0; i<13; i++) {}
 232   2       }
 233   1      }
 234          
 235          /**********************************************************/
 236          void delay1(int ms)
 237          {
 238   1       unsigned char y;
 239   1        while(ms--)
 240   1       {
 241   2        for(y = 0; y<250; y++)
C51 COMPILER V7.50   IRLCD                                                                 11/08/2010 20:39:54 PAGE 5   

 242   2        {
 243   3         _nop_();
 244   3         _nop_();
 245   3         _nop_();
 246   3         _nop_();
 247   3        }
 248   2       }
 249   1      }
 250          
 251          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    495    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     39       5
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
