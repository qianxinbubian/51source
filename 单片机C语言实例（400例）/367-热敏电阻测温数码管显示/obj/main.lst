C51 COMPILER V8.02   MAIN                                                                  05/25/2013 14:36:44 PAGE 1   


C51 COMPILER V8.02, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN .\obj\main.obj
COMPILER INVOKED BY: C:\Keil\C51\BIN\C51.EXE main.c BROWSE DEBUG OBJECTEXTEND PRINT(.\obj\main.lst) OBJECT(.\obj\main.ob
                    -j)

line level    source

   1          
   2          #include <reg52.h>                
   3          #include "i2c.h"
   4          #include "delay.h"
   5          #include "display.h"
   6          
   7          
   8          code unsigned int  vt_table[]=  // 电压温度对照表
   9                  {
  10                    4132,4098,4063,4026,3988,3949,3908,3866,3823,3779,
  11                          3733,3686,3639,3590,3540,3489,3437,3385,3331,3277,
  12                          3222,3166,3110,3054,2997,2940,2882,2824,2767,2709,
  13                          2651,2593,2536,2478,2421,2365,2309,2253,2198,2143,
  14                          2089,2036,1984,1932,1881,1831,1782,1734,1686,1640,
  15                          1594,1550,1506,1464,1422,1381,1341,1303,1265,1228,
  16                          1192
  17                  };
  18          
  19          #define AddWr 0x90   //写数据地址 PCF8591
  20          #define AddRd 0x91   //读数据地址 PCF8591
  21          
  22          extern bit ack;
  23          unsigned char ReadADC(unsigned char Chl);
  24          /*------------------------------------------------
  25                        主程序
  26          ------------------------------------------------*/
  27          main()
  28          {
  29   1       unsigned int num=0;
  30   1       unsigned char i;
  31   1       unsigned int temp;
  32   1       Init_Timer0();
  33   1      
  34   1      while (1)         //主循环
  35   1        {
  36   2        
  37   2       num=ReadADC(1);
  38   2      //变成mv 最大值255 。255x19=4845mv，如果增加精度可以使用浮点计算
  39   2       num=num*19;    
  40   2       for(i=0;i<61;i++)
  41   2         {
  42   3      //判断采集电压值大于或者等于表格电压时，停下来并记录当前i值
  43   3          if(num >= vt_table[i])
  44   3             {
  45   4              temp=i;
  46   4      //如果是前10个数据表明是负温度，需要把温度符号显示出来，并且前10位温度递增
  47   4              if(i<10) 
  48   4                {
  49   5                temp=10-temp;    //如果i=0，表示-10
  50   5                TempData[0]=0xbf;//'-'号
  51   5                }
  52   4              else
  53   4                {
  54   5                temp-=10; //如果大于等于10表明正温度，把前10个表格负温度去掉
C51 COMPILER V8.02   MAIN                                                                  05/25/2013 14:36:44 PAGE 2   

  55   5                TempData[0]=0xff;//符号位显示空
  56   5                }
  57   4                      break;             //检测到即跳出循环，否则继续循环
  58   4              }
  59   3                
  60   3            }
  61   2       
  62   2           
  63   2       TempData[1]=DuanMa[temp/10];
  64   2       TempData[2]=DuanMa[temp%10];
  65   2       DelayMs(200);                    //延时防止采集频率过快
  66   2        }
  67   1      }
  68          /*------------------------------------------------
  69                       读AD转值程序
  70          输入参数 Chl 表示需要转换的通道，范围从0-3
  71          返回值范围0-255
  72          ------------------------------------------------*/
  73          unsigned char ReadADC(unsigned char Chl)
  74           {
  75   1         unsigned char Val;
  76   1         Start_I2c();               //启动总线
  77   1         SendByte(AddWr);             //发送器件地址
  78   1           if(ack==0)return(0);
  79   1         SendByte(0x40|Chl);            //发送器件子地址
  80   1           if(ack==0)return(0);
  81   1         Start_I2c();
  82   1         SendByte(AddWr+1);
  83   1            if(ack==0)return(0);
  84   1         Val=RcvByte();
  85   1         NoAck_I2c();                 //发送非应位
  86   1         Stop_I2c();                  //结束总线
  87   1        return(Val);
  88   1       }
  89          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    222    ----
   CONSTANT SIZE    =    122    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----       6
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
