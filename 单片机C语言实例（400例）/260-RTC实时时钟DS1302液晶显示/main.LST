C51 COMPILER V7.06   MAIN                                                                  08/23/2009 17:03:43 PAGE 1   


C51 COMPILER V7.06, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN main.OBJ
COMPILER INVOKED BY: d:\Keil\C51\BIN\C51.EXE main.c BROWSE DEBUG OBJECTEXTEND

stmt level    source

   1          /*-----------------------------------------------
   2            ƣLCD1602ʾʵʱʱ
   3            ˾ϺӿƼ޹˾
   4            վwww.doflye.cn
   5            дʦ
   6            ڣ2009.5
   7            ޸ģ
   8            ݣͨȡds1302ϢֱʾҺϡбõأϵʱԿСͨڵʱ
             -䡣·ʽ
   9                  ڷдʱϢʽ 2009071210102005 ʾ2009712 101020 壬Ȼͨ
             -ڷͣӲӷʽ
  10                          ͨͬעм䲻пո
  11            -----------------------------------------------*/
  12          #include<reg52.h>
  13          #include"ds1302.h"
  14          #include"LCD1602.h"
  15          
  16          sbit LACTCH1=P2^0;//˿ڶ
  17          sbit LACTCH2=P2^3;
  18          
  19          
  20          bit SetFlag;      //ʱ־λ
  21          unsigned char time_buf2[16];
  22          void UART_Init(void)
  23          {
  24   1          SCON  = 0x50;                       /* SCON: ģʽ 1, 8-bit UART, ʹܽ         */
  25   1          TMOD |= 0x20;               /* TMOD: timer 1, mode 2, 8-bit reload        */
  26   1          TH1   = 0xFD;               /* TH1:  reload value for 9600 baud @ 11.0592MHz   */
  27   1          TR1   = 1;                  /* TR1:  timer 1 run                          */
  28   1          EA    = 1;                  /*ж*/
  29   1          ES    = 1;                  /*򿪴ж*/
  30   1      
  31   1      }
  32          main()
  33          {
  34   1        unsigned char i;
  35   1      
  36   1             UART_Init();
  37   1             P0=0;       //ȡʾ,ʾ
  38   1             LACTCH1=1;  //
  39   1             LACTCH1=0;
  40   1             
  41   1                 P0=0;       //ȡ
  42   1             LACTCH2=1;  // 
  43   1             LACTCH2=0;
  44   1                
  45   1             ds1302_init(); /*DS302ʼ*/
  46   1             //ds1302_write_time();
  47   1             InitLcd();     //ʼLCD
  48   1             DelayMs(15);   //ʱȶ
  49   1      
  50   1        while(1)
  51   1             {
  52   2                  ds1302_read_time();//ȡʱϢ
  53   2              for(i=1;i<8;i++)
C51 COMPILER V7.06   MAIN                                                                  08/23/2009 17:03:43 PAGE 2   

  54   2                         TempData[i]=time_buf1[i];
  55   2                 disp();         //ҺʾʱϢ
  56   2                 //KeyPro();
  57   2                         if(SetFlag)     //յϢʱ
  58   2                           {
  59   3                               for(i=0;i<8;i++)
  60   3                               {
  61   4                               time_buf1[i]=time_buf2[2*i]*10+time_buf2[2*i+1];//ϣ2 15ϳ15
  62   4                               }
  63   3                               ds1302_write_time();
  64   3                               SetFlag=0;     //ʱϢº־λ
  65   3                               }
  66   2                   }
  67   1       
  68   1        }
  69          
  70          /******************************************************************/
  71          /*                  жϳ                                  */
  72          /******************************************************************/
  73          void UART_SER (void) interrupt 4 //жϷ
  74          {
  75   1          unsigned char Temp;          //ʱ 
  76   1          
  77   1          unsigned char i;
  78   1         if(RI)                        //жǽжϲ
  79   1           {
  80   2                RI=0;                      //־λ
  81   2                Temp=SBUF;                 //뻺ֵ
  82   2                time_buf2[i]=Temp&0x0F;
  83   2                i++;
  84   2                if(i==16)                  //16ַϢ
  85   2                 {
  86   3                  i=0;
  87   3                      SetFlag=1;               //ɱ־λ1
  88   3                 }
  89   2            SBUF=Temp; //ѽյֵٷصԶ
  90   2                //P1=Temp&0x0F; //ʱʾ
  91   2               }
  92   1         if(TI)  //Ƿͱ־λ
  93   1           TI=0;
  94   1      } 


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    882    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     74       7
   IDATA SIZE       =   ----    ----
   BIT SIZE         =      1    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
